<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png"/>
    <link rel="stylesheet" type="text/css" href="css/formulario.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <meta name="theme-color" content="#8e3dbc" />
    <title>Reportar problemas</title>
  </head>
  <body>
    <div class="navbar-fixed">
      <nav>
        <div class="nav-wrapper">
          <a class="brand-logo center">ToiletFY</a>
          <ul class="right hide-on-med-and-down">
            <li>
              <a href="index.html" title="Página inicial"><i class="material-icons">home</i></a>
            </li>
            <li>
              <a href="adicionar.html" title="Adicionar banheiro"><i class="material-icons">add_location</i></a>
            </li>
            <li>
              <a href="sobre.html" title="Sobre ToiletFY"><i class="material-icons">info</i></a>
            </li>
          </ul>

          <ul id="nav-mobile" class="sidenav">
            <li>
              <a href="index.html"><i class="material-icons">home</i>Página inicial</a>
            </li>
            <hr />
            <li>
              <a href="adicionar.html"><i class="material-icons">add_location</i>Adicionar banheiro</a>
            </li>
            <hr />
            <li>
              <a href="sobre.html"><i class="material-icons">info</i>Sobre</a>
            </li>
            <hr />
            <br /><br /><br /><br /><br />
            <li class="warning">
              <a href="privacidade.html"><i class="material-icons">lock</i>Política de Privacidade</a>
            </li>
          </ul>
          <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        </div>
      </nav>
    </div>
    <div class="containers">
      <div id="contacts" autocorrect="off" name="reportar" autocomplete="off" method="post">
        <h3>Reportar problemas</h3>
        <br />
        <fieldset class="fs">
          <input id="nome" name="nome" placeholder="Seu nome" type="text" tabindex="1" autofocus autocomplete="off"/>
        </fieldset>
        <fieldset class="fs">
          <input id="nomelocal" class="input-field" name="nomelocal" placeholder="Nome do local" type="text" tabindex="2" required autocomplete="off"/>
        </fieldset>
        <fieldset class="fs">
          <input  class="input-field localizacao" name="endereco" id="endereco"  type="text"  placeholder="Endereço"  readonly tabindex="3" required>
          <div class="location" id="showMe" title="Usar minha localização"></div>
          <div id="mapa" style="width:10%; height:10%"></div>
        </fieldset>
        <fieldset class="fs">
          <textarea class="input-field" name="descricao" placeholder="Descrição do problema" id="descricao" tabindex="4" required></textarea>
        </fieldset>
        <fieldset class="fs">
          <button id="submit" name="submit" class=" waves-effect waves-light btn center-align" type="button" onclick="reportar()" id="contact-submit" data-submit="Enviando...">
            <i class="material-icons left"> cloud_upload</i>ENVIAR
          </button>
          <input id="valorlat" type="text" name="latitude" readonly value="" />
          <input id="valorlong" type="text" name="longitude" readonly value=""/>
        </fieldset>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjpzomu3rr8iX1yMYdOgkevViVGzsbGLU"></script>
    <script src="js/marcador.js"></script>
    <script src="js/materialize.js"></script>
    <script src="js/init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>
    <script>
      async function reportar() {
        var nome = document.getElementById("nome").value;
        var nomelocal = document.getElementById("nomelocal").value;
        var endereco = document.getElementById("endereco").value;
        var descricao = document.getElementById("descricao").value;
        var valorlat = document.getElementById("valorlat").value;
        var valorlong = document.getElementById("valorlong").value;

        const response = await axios.post("http://192.241.133.153/reportar", {
          nome: nome,
          nomelocal: nomelocal,
          endereco: endereco,
          descricao: descricao,
          latitude: valorlat,
          longitude: valorlong
        });

        if(nomelocal == "") return alert('O nome do local não pode ficar em branco')
        if(endereco == "") return alert('O endereço não pode ficar em branco')
        if (descricao == "") return alert("Por favor, informe o problema!");

        console.log(response.data);
        
        if (response.data.affectedRows == "1") {
          alert("Dados reportados com sucesso!");
          $(':input', '#contacts')
          .not(':button, :submit, :reset, :hidden')
          .val('')
          .removeAttr('checked')
          .removeAttr('selected');
        }
      }
    </script>
  </body>
</html>
